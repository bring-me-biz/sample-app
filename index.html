<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        img {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        form {
            display: flex;
            flex-direction: column;
        }
    </style>
    <script src="static.js"></script>

</head>
<body style="background-color:#fff;">
<script src="microapp.js"></script>
<img src="logo.png" style="width:72px;"/>
<form method="post" action="https://bmb-ayoba-api.ey.r.appspot.com">
    <label for="name">Name:</label>
    <input id="name" name="name" required>

    <label for="surname">Surname:</label>
    <input id="surname" name="surname" required>

    <div>
        <input type="checkbox" required id="tandcs" name="tandcs"><label for="tandcs">Do you agree to the terms and
        conditions?</label>
    </div>

    <input type="hidden" name="product_id" id="product_id" value="229">
    <input type="hidden" name="affiliate_id" id="affiliate_id" value="34">

    <input type="hidden" name="cellphone" id="cellphone">

    <div class="scroller" style="overflow: scroll; height: 600px;">
        <pre id="logger" style="text-transform:capitalize; background-color: #f5f5f5; margin-bottom: 0;"></pre>
    </div>

    <button id="submit" type="submit">Submit</button>
</form>
<script>
    consoletodiv('logger')
    console.log('Logger loaded...')
    var count = 1;
    var skipDefer = false;

    function defer(method) {
        console.log('defer called: ', count++);
        if (skipDefer) {
            return;
        }
        try {
            if (Ayoba && Ayoba.hasOwnProperty('getMsisdn') && Ayoba.getMsisdn()) {
                console.log('Ayoba loaded...');
                method();
                skipDefer = true;
            } else {
                console.log('Ayoba not read yet...');
                setTimeout(function () {
                    defer(method)
                }, 50);
            }
        } catch (e) {
            console.log('An error occurred', e.message);
            setTimeout(function () {
                defer(method)
            }, 50);
        }
    }

    function onPresenceChanged(presence) {
        console.log("Event: presence changed:" + presence)
        defer(function () {
            function getMsisdn() {
                var msisdn = Ayoba.getMsisdn();
                var input = document.querySelector('#cellphone');
                input.value = msisdn;
            }


            console.log(Object.getOwnPropertyNames(Ayoba).join(', '))
            console.log('Msisdn: ');
            console.log(Ayoba.getMsisdn())
            getMsisdn();
        })
    }
</script>
</body>
</html>
